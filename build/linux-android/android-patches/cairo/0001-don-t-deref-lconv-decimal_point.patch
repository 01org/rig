From 257a56c37e6e5e2e6ce400ccdf067bfd8e651643 Mon Sep 17 00:00:00 2001
From: Robert Bragg <robert@linux.intel.com>
Date: Thu, 6 Mar 2014 21:27:40 +0000
Subject: [PATCH] don't deref lconv->decimal_point

---
 src/cairo-cff-subset.c    | 4 ++++
 src/cairo-output-stream.c | 4 ++++
 src/cairo-type1-subset.c  | 4 ++++
 3 files changed, 12 insertions(+)

diff --git a/src/cairo-cff-subset.c b/src/cairo-cff-subset.c
index c420bd4..321cc99 100644
--- a/src/cairo-cff-subset.c
+++ b/src/cairo-cff-subset.c
@@ -305,8 +305,12 @@ decode_real (unsigned char *p, double *real)
     char *buf = buffer;
     char *buf_end = buffer + sizeof (buffer);
 
+#ifndef __ANDROID__
     locale_data = localeconv ();
     decimal_point = locale_data->decimal_point;
+#else
+    decimal_point = ".";
+#endif
     decimal_point_len = strlen (decimal_point);
 
     assert (decimal_point_len != 0);
diff --git a/src/cairo-output-stream.c b/src/cairo-output-stream.c
index cc7e300..1eae2bb 100644
--- a/src/cairo-output-stream.c
+++ b/src/cairo-output-stream.c
@@ -314,8 +314,12 @@ _cairo_dtostr (char *buffer, size_t size, double d, cairo_bool_t limited_precisi
     if (d == 0.0)
 	d = 0.0;
 
+#ifndef __ANDROID__
     locale_data = localeconv ();
     decimal_point = locale_data->decimal_point;
+#else
+    decimal_point = ".";
+#endif
     decimal_point_len = strlen (decimal_point);
 
     assert (decimal_point_len != 0);
diff --git a/src/cairo-type1-subset.c b/src/cairo-type1-subset.c
index 4b64403..f55aeeb 100644
--- a/src/cairo-type1-subset.c
+++ b/src/cairo-type1-subset.c
@@ -313,8 +313,12 @@ cairo_type1_font_subset_get_matrix (cairo_type1_font_subset_t *font,
     const char *decimal_point;
     int decimal_point_len;
 
+#ifndef __ANDROID__
     locale_data = localeconv ();
     decimal_point = locale_data->decimal_point;
+#else
+    decimal_point = ".";
+#endif
     decimal_point_len = strlen (decimal_point);
 
     assert (decimal_point_len != 0);
-- 
1.9.0

